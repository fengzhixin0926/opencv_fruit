# opencv_fruit
（1）调用 get_data.py 文件，输入视频路径和水果源图片总数，读取已录制好的游戏视频，每间隔 100 帧提取一张图片，共获得 600 张水果源图片，保存在 source 文件夹。

（2）调用 preprocess.py 文件，输入为水果源图片和图片总数，对输入的图片进行背景去除、腐蚀、膨胀、中值滤波等预处理操作，将去除背景的图片保存在 background 文件夹，同时对原图片中的水果做轮廓提取，得到单独的水果图片，存储在 fruit 文件夹。

（3）调用 show_rgb.py 文件，输入图片路径，显示去除背景后 background 文件家中图片的 RGB 颜色空间，将结果保存分别在 r、g、b 三个文件夹。

（4）调用 down_sampling.py 文件, 输入图片路径，由于游戏中的拖尾造成 fruit 文件夹中图片的大小不一致，通过编程，统一大小为 64×64，对于长方形的图片，直接变换会发生形变，因此采取填充的方式，做成 1：1 的正方形，再 resize。图片存储在 resize 文件夹中。

（5）人工对 resize 文件夹中的图片按照水果类别进行分类，删除图片中存在水果重叠、部分水果、切开后水果水渍等不可用问题图片，分类别存储于 single 文件夹中。由于 resize文件夹中的图片存储具有乱序性，每个水果类别中图片名不是依次递增排列，因此调用rename.py，对每个类别中的图片重新命名。

（6）调用 label.py 文件，读取 single 文件夹中分类完的所有水果，对每个水果按文件夹名打标签，存储在 fruit.npz 中。

（7）调用 dataloader.py 文件，以 Dataset 作为父类，书写 ImageSet 类，按照 1:3 的比例，划分测试集与训练集，按照神经网络输入的要求，修改输入图片尺寸为 32×32，将图片转换为 tensor 格式，输入“trian”或“test”， 获取相应部分的图片和标签。

（8）调用 train.py 文件，统计可知，水果源图片中共有 11 种类别的水果，因此num_classes=11，采用 CrossEntropyLoss()作为损失函数，batch_size 大小为 64，学习率为 0.01，舍去训练集部分数据，不更新学习率的方式，训练 100 个 epoch，保存最佳的训练模型，用于后续测试。输出 100 个 epoch 中最高准确率。
